{% extends "admin/adminlayout.html" %}
{% block content %}

<!-- start: content -->
<div id="content">
  <div class="panel">
    <div class="panel-body">
      <div class="col-md-6 col-sm-12">
        <h3 class="animated fadeInLeft">Admin Dashboard</h3>
      </div>
    </div>
  </div>

  <div class="col-md-12" style="padding:20px;">
    <div class="col-md-12 padding-0">
      <div class="col-md-8 padding-0">
        <div class="col-md-12 padding-0">

          <!-- Total Users -->
          <div class="col-md-6">
            <div class="panel box-v1">
              <div class="panel-heading bg-white border-none">
                <div class="col-md-6 col-sm-6 col-xs-6 text-left padding-0">
                  <h4 class="text-left">Total Users</h4>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-right">
                  <h4><span class="icon-user icons icon text-right"></span></h4>
                </div>
              </div>
              <div class="panel-body text-center">
                <h1>{{ total_users }}</h1>
                <p>User active</p>
                <hr/>
              </div>
            </div>
          </div>

          <!-- Total Bookings -->
          <div class="col-md-6">
            <div class="panel box-v1">
              <div class="panel-heading bg-white border-none">
                <div class="col-md-6 col-sm-6 col-xs-6 text-left padding-0">
                  <h4 class="text-left">Total Bookings</h4>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-right">
                  <h4><span class="icon-basket-loaded icons icon text-right"></span></h4>
                </div>
              </div>
              <div class="panel-body text-center">
                <h1>{{ total_bookings }}</h1>
                <p>New Orders</p>
                <hr/>
              </div>
            </div>
          </div>

          <!-- Active Packages -->
          <div class="col-md-6">
            <div class="panel box-v1">
              <div class="panel-heading bg-white border-none">
                <div class="col-md-6 col-sm-6 col-xs-6 text-left padding-0">
                  <h4 class="text-left">Active Packages</h4>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-right">
                  <h4><span class="icon-briefcase icons icon text-right"></span></h4>
                </div>
              </div>
              <div class="panel-body text-center">
                <h1>{{ total_packages }}</h1>
                <p>Packages Running</p>
                <hr/>
              </div>
            </div>
          </div>

          <!-- Total Revenue -->
          <div class="col-md-6">
            <div class="panel box-v1">
              <div class="panel-heading bg-white border-none">
                <div class="col-md-6 col-sm-6 col-xs-6 text-left padding-0">
                  <h4 class="text-left">Total Revenue</h4>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-right">
                  <h4><span class="icon-wallet icons icon text-right"></span></h4>
                </div>
              </div>
              <div class="panel-body text-center">
                <h1>₹3,21,000</h1>
                <p>Revenue Earned</p>
                <hr/>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Reports Overview -->
      <div class="border-none">
        <h4>Reports Overview</h4>
      </div>
      <div class="panel-body">

        <!-- Bookings Verified -->
        <div class="media">
          <div class="media-left">
            <span class="icon-check icons" style="font-size:2em;"></span>
          </div>
          <div class="media-body">
            <h5 class="media-heading">Bookings Verified</h5>
            <p style="margin: 0;">
              <strong>{{ booking_verified }}</strong> bookings verified out of 
              <strong>{{ total_bookings }}</strong>
            </p>
            <div class="progress progress-mini">
              <div class="progress-bar progress-bar-success" role="progressbar" style="width: {{ booking_verified_percent }}%;">
                <span class="sr-only">{{ booking_verified_percent }}% Complete</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Pending Bookings -->
        <div class="media">
          <div class="media-left">
            <span class="icon-credit-card icons" style="font-size:2em;"></span>
          </div>
          <div class="media-body">
            <h5 class="media-heading">Pending Bookings</h5>
            <p style="margin: 0;">
              <strong>{{ pending_bookings }}</strong> bookings are pending out of 
              <strong>{{ total_bookings }}</strong>
            </p>
            <div class="progress progress-mini">
              <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ pending_percent }}%;">
                <span class="sr-only">{{ pending_percent }}% Pending</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Popular Package -->
        <div class="media">
          <div class="media-left">
            <span class="icon-star icons" style="font-size:2em;"></span>
          </div>
          <div class="media-body">
            <h5 class="media-heading">Popular Package (This Month)</h5>
            <p style="margin: 0;">
              <strong>{{ popular_package }}</strong> – {{ popular_count }} bookings
            </p>
            <div class="progress progress-mini">
              <div class="progress-bar progress-bar-warning" role="progressbar" style="width: {{ popular_percent }}%;">
                <span class="sr-only">{{ popular_percent }}% Complete</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Blocked Users -->
        <div class="media">
          <div class="media-left">
            <span class="icon-user-unfollow icons" style="font-size:2em;"></span>
          </div>
          <div class="media-body">
            <h5 class="media-heading">Blocked/Inactive Users</h5>
            <p style="margin: 0;">
              <strong>{{ blocked_users }}</strong> blocked out of 
              <strong>{{ total_users }}</strong> users
            </p>
            <div class="progress progress-mini">
              <div class="progress-bar progress-bar-danger" role="progressbar" style="width: {{ blocked_percent }}%;">
                <span class="sr-only">{{ blocked_percent }}% Complete</span>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="col-md-12 card-wrap padding-0">

    <!-- Monthly Bookings Chart -->
    <div class="col-md-6">
      <div class="panel chart-panel">
        <div class="panel-heading bg-white border-none" style="padding:20px;">
          <div class="col-md-6 text-left">
            <h4>Monthly Bookings</h4>
          </div>
          <div class="col-md-6 text-right">
            <div class="mini-onoffswitch pull-right onoffswitch-danger" style="margin-top:10px;">
              <input type="checkbox" name="onoffswitch2" class="onoffswitch-checkbox" id="myonoffswitch1" checked>
              <label class="onoffswitch-label" for="myonoffswitch1"></label>
            </div>
          </div>
        </div>
        <div class="panel-body text-center" style="height: 400px;">
          <canvas class="line-chart" style="height: 280px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Top Destinations Chart -->
    <div class="col-md-6">
      <div class="panel chart-panel">
        <div class="panel-heading bg-white border-none" style="padding:20px;">
          <div class="col-md-12 text-left">
            <h4>Top 5 Booked Destinations</h4>
          </div>
        </div>
        <div class="panel-body d-flex justify-content-center align-items-center" style="height: 400px; display: flex; justify-content: center; align-items: center;">
          <canvas id="topDestinationPieChart" style="height: 280px; width: 280px;"></canvas>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
new Chart(document.querySelector('.line-chart'), {
  type: 'line',
  data: {
    labels: {{ month_labels|tojson }},
    datasets: [{
      label: 'Bookings',
      data: {{ monthly_counts|tojson }},
      borderColor: '#3498db',
      backgroundColor: 'rgba(52,152,219,0.2)',
      fill: true
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        display: true
      }
    }
  }
});
</script>

<script>
const ctx2 = document.getElementById('topDestinationPieChart').getContext('2d');
const pieChart = new Chart(ctx2, {
  type: 'pie',
  data: {
    labels: {{ top_package_names | tojson | safe }},
    datasets: [{
      label: 'Top Booked Packages',
      data: {{ top_package_counts | tojson | safe }},
      backgroundColor: [
        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'
      ],
      borderColor: '#fff',
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        position: 'bottom',
        labels: {
          boxWidth: 15,
          font: {
            size: 13
          }
        }
      },
      tooltip: {
        callbacks: {
          label: function(context) {
            return `${context.label}: ${context.raw} bookings`;
          }
        }
      }
    }
  }
});
</script>

<!-- end: content -->
{% endblock %}

